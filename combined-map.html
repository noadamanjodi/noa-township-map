<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Township Combined Map ‚Äì Sector 1 & 2</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">

<style>
html,body{
  height:100%;
  margin:0;
  font-family:Segoe UI,Arial;
  background:#f4f6fb;
}
.app{height:100%;display:flex;flex-direction:column}
header{
  background:#003f88;
  color:#fff;
  padding:12px;
  font-size:18px;
  font-weight:600;
  text-align:center
}
.content{flex:1;display:flex;min-height:0}

/* SIDEBAR */
.sidebar{
  width:320px;
  background:#fff;
  padding:14px;
  box-shadow:2px 0 12px rgba(0,0,0,.1);
  position:relative;
}
.panel{margin-bottom:16px}
input,select,button{
  width:100%;
  padding:12px;
  border-radius:10px;
  border:1px solid #ccc;
  margin-top:8px;
  font-size:15px
}
button{
  cursor:pointer;
  font-weight:600;
  background:#ffd24d;
  border:none
}

/* AUTOSUGGEST */
.suggest-box{
  position:absolute;
  top:175px;
  left:14px;
  right:14px;
  background:#fff;
  border-radius:10px;
  box-shadow:0 6px 18px rgba(0,0,0,.15);
  z-index:2000;
  max-height:220px;
  overflow:auto;
  display:none;
}
.suggest-item{
  padding:10px 12px;
  cursor:pointer;
  font-size:15px;
  border-bottom:1px solid #eee;
}
.suggest-item:hover{background:#eef4ff}

/* MAP */
.map-wrap{flex:1}
#map{width:100%;height:100%}
.leaflet-image-layer{pointer-events:none}

/* MOBILE */
@media(max-width:768px){
  .content{flex-direction:column}
  .sidebar{width:100%}
}
</style>
</head>

<body>
<div class="app">
<header>Township Map ‚Äì Sector 1 & Sector 2</header>

<div class="content">

<aside class="sidebar">

  <!-- SECTOR SELECT -->
  <div class="panel">
    <strong>Select Sector</strong>
    <select id="sectorSelect">
      <option value="1">Sector-1</option>
      <option value="2">Sector-2</option>
    </select>
  </div>

  <!-- SEARCH -->
  <div class="panel">
    <strong>Search Quarter</strong>
    <input id="searchInput" placeholder="Example: B-168" autocomplete="off">
    <button id="searchBtn">üîç Find</button>
    <div id="suggestBox" class="suggest-box"></div>
  </div>

</aside>

<div class="map-wrap">
  <div id="map"></div>
</div>

</div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
/* ================= MAP ================= */
const IMG_W = 4400;
const IMG_H = 3080;

const map = L.map("map",{crs:L.CRS.Simple,minZoom:-4});
const bounds = [
  map.unproject([0,IMG_H],0),
  map.unproject([IMG_W,0],0)
];

/* ================= IMAGE OVERLAYS ================= */
const overlay1 = L.imageOverlay("./sector1.png", bounds);
const overlay2 = L.imageOverlay("./sector2.png", bounds);

/* ================= GROUPS ================= */
const group1 = L.featureGroup();
const group2 = L.featureGroup();

const layers = {1:{},2:{}};
let data = [];

/* ================= LOAD JSONs ================= */
Promise.all([
  fetch("https://raw.githubusercontent.com/noadamanjodi/noa-township-map/main/sector1_ranges.json").then(r=>r.json()),
  fetch("https://raw.githubusercontent.com/noadamanjodi/noa-township-map/main/sector2_ranges.json").then(r=>r.json())
]).then(([s1,s2])=>{
  data = [
    ...(s1.sectors?.[1] || []),
    ...(s2.sectors?.[2] || [])
  ];
  render();
  switchSector(1); // default
});

/* ================= RENDER ================= */
function render(){
  data.forEach(b=>{
    const rect = L.rectangle(b.boundsLatLng,{
      color: b.sector===1 ? "#1976d2" : "#c62828",
      weight:2,
      fillOpacity:0.35
    }).bindTooltip(`Sector-${b.sector} : ${b.rangeText}`,{sticky:true});

    if(b.sector===1){
      rect.addTo(group1);
      layers[1][b.id]=rect;
    }else{
      rect.addTo(group2);
      layers[2][b.id]=rect;
    }
  });
}

/* ================= SECTOR SWITCH ================= */
function switchSector(sec){
  map.eachLayer(l=>{
    if(l!==map) map.removeLayer(l);
  });

  if(sec==1){
    overlay1.addTo(map);
    group1.addTo(map);
  }else{
    overlay2.addTo(map);
    group2.addTo(map);
  }
  map.fitBounds(bounds);
}

sectorSelect.onchange=()=>{
  switchSector(parseInt(sectorSelect.value,10));
  searchInput.value="";
  suggestBox.style.display="none";
};

/* ================= SEARCH ================= */
function doSearch(quarter){
  const sector = parseInt(sectorSelect.value,10);
  const found = data.find(d =>
    d.sector===sector && d.expanded.includes(quarter)
  );
  if(!found){
    alert("Block not found in selected sector");
    return;
  }
  map.fitBounds(layers[sector][found.id].getBounds().pad(0.35));
}

searchBtn.onclick=()=>{
  const q = searchInput.value.trim().toUpperCase();
  if(!q) return;
  doSearch(q);
};

/* ================= AUTO-SUGGEST ================= */
const suggestBox = document.getElementById("suggestBox");

searchInput.oninput=()=>{
  const q = searchInput.value.trim().toUpperCase();
  suggestBox.innerHTML="";
  if(q.length<2){
    suggestBox.style.display="none";
    return;
  }

  const sector = parseInt(sectorSelect.value,10);
  const matches = [];

  data.forEach(d=>{
    if(d.sector!==sector) return;
    d.expanded.forEach(b=>{
      if(b.startsWith(q)) matches.push(b);
    });
  });

  [...new Set(matches)].slice(0,20).forEach(b=>{
    const div=document.createElement("div");
    div.className="suggest-item";
    div.textContent=b;
    div.onclick=()=>{
      searchInput.value=b;
      suggestBox.style.display="none";
      doSearch(b);
    };
    suggestBox.appendChild(div);
  });

  suggestBox.style.display = matches.length ? "block" : "none";
};

document.addEventListener("click",e=>{
  if(!suggestBox.contains(e.target) && e.target!==searchInput){
    suggestBox.style.display="none";
  }
});
</script>
</body>
</html>
